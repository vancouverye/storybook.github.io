<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶ ì»¤ë®¤ë‹ˆí‹°</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; background: #0b0e12; color: #e7ecf2; }
    header, footer { background: #11161c; padding: 12px; text-align: center; border-bottom: 1px solid #1f2937; }
    nav button { margin: 4px; padding: 8px 14px; border: none; border-radius: 6px; background: #1e293b; color: #fff; cursor: pointer; }
    nav button:hover { background: #2563eb; }
    main { padding: 20px; max-width: 800px; margin: auto; }
    .hidden { display: none; }
    textarea, input { width: 100%; padding: 8px; margin-top: 6px; border-radius: 6px; border: 1px solid #1f2937; background: #11161c; color: #fff; }
    button { padding: 8px 12px; border-radius: 6px; border: none; background: #2563eb; color: white; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .card { background: #11161c; padding: 12px; border-radius: 8px; margin-bottom: 12px; }
  </style>
</head>
<body>
  <header>
    <h2>ğŸ“š ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶</h2>
    <nav>
      <button onclick="showPage('home')">ğŸ  í™ˆ</button>
      <button onclick="showPage('stories')">ğŸ“– ìŠ¤í† ë¦¬ë¶</button>
      <button onclick="showPage('next')">âœ¨ ë‹¤ìŒ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì¼ê¹Œ?</button>
      <button onclick="showPage('admin')">âš™ï¸ ê´€ë¦¬ì</button>
    </nav>
  </header>

  <main>
    <section id="home">
      <h3>ğŸŒŸ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
      <p>ì´ê³³ì€ ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶ ì»¤ë®¤ë‹ˆí‹°ì…ë‹ˆë‹¤.<br>
      ê´€ë¦¬ìê°€ ìš´ì˜í•˜ëŠ” ê³µì‹ ìŠ¤í† ë¦¬ë¶ê³¼, ì—¬ëŸ¬ë¶„ì´ ì§ì ‘ ì œì•ˆí•  ìˆ˜ ìˆëŠ” ë‹¤ìŒ ì´ì•¼ê¸° ê³µê°„ì´ ìˆìŠµë‹ˆë‹¤.</p>
    </section>

    <section id="stories" class="hidden">
      <h3>ğŸ“– ìŠ¤í† ë¦¬ë¶</h3>
      <div id="story-list"></div>
    </section>

    <section id="next" class="hidden">
      <h3>âœ¨ ë‹¤ìŒ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì¼ê¹Œ?</h3>
      <form id="suggest-form">
        <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„" required>
        <textarea id="suggest-text" rows="5" placeholder="ë‹¤ìŒ ì´ì•¼ê¸°ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”..." required></textarea>
        <button type="submit">ì œì•ˆ ì˜¬ë¦¬ê¸°</button>
      </form>
      <h4>ğŸ’¡ ìµœê·¼ ì œì•ˆ</h4>
      <div id="suggestions"></div>
    </section>

    <section id="admin" class="hidden">
      <h3>âš™ï¸ ê´€ë¦¬ì íŒ¨ë„</h3>
      <div id="admin-login">
        <input type="password" id="admin-pass" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
        <button onclick="adminLogin()">ë¡œê·¸ì¸</button>
      </div>
      <div id="admin-panel" class="hidden">
        <h4>ğŸ“œ ì œì•ˆ ëª©ë¡</h4>
        <div id="admin-suggestions"></div>
      </div>
    </section>
  </main>

  <footer>
    <small>Â© 2025 ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶ ì»¤ë®¤ë‹ˆí‹°</small>
  </footer>

  <!-- âœ… Firebase SDKëŠ” í•­ìƒ ë¨¼ì € ë¡œë“œ -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    // ğŸ”‘ ì—¬ê¸°ì— ë„¤ Firebase ì„¤ì •(firebaseConfig) ë¶™ì—¬ë„£ê¸°
const firebaseConfig = {
  apiKey: "AIzaSyBEBA0ZUVcMBG_G9CtauP02kh4Wneg-5gA",
  authDomain: "storybook-4a13b.firebaseapp.com",
  projectId: "storybook-4a13b",
  storageBucket: "storybook-4a13b.firebasestorage.app",
  messagingSenderId: "756981563455",
  appId: "1:756981563455:web:b0bef64ba3ca2fb39a788a",
  measurementId: "G-CPXLQYTYJY"
};


    // âœ… Firebase ì´ˆê¸°í™” (ì´ê²Œ ë°˜ë“œì‹œ ë¨¼ì € ì‹¤í–‰ë˜ì–´ì•¼ í•¨)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // âœ… ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
    const ADMIN_PASSWORD = "admin1234";

    // âœ… í˜ì´ì§€ ì „í™˜
    function showPage(id) {
      document.querySelectorAll("main section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id === "stories") loadStories();
      if (id === "next") loadSuggestions();
      if (id === "admin") loadAdminSuggestions();
    }

    // âœ… ìŠ¤í† ë¦¬ ë¡œë“œ
    async function loadStories() {
      const list = document.getElementById("story-list");
      list.innerHTML = "";
      try {
        const snap = await db.collection("stories").orderBy("title").get();
        if (snap.empty) {
          list.innerHTML = "<p>ì•„ì§ ë“±ë¡ëœ ìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }
        snap.forEach(doc => {
          const s = doc.data();
          list.innerHTML += `<div class="card"><h4>${s.title}</h4><p>${s.text}</p></div>`;
        });
      } catch (err) {
        console.error("ìŠ¤í† ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
      }
    }

    // âœ… ì œì•ˆ ì œì¶œ
    document.getElementById("suggest-form").addEventListener("submit", async e => {
      e.preventDefault();
      const name = nickname.value.trim();
      const text = suggestText.value.trim();
      if (!name || !text) return;
      try {
        await db.collection("suggestions").add({ name, text, created: new Date() });
        alert("ì œì•ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        nickname.value = "";
        suggestText.value = "";
        loadSuggestions();
      } catch (err) {
        console.error("ì œì•ˆ ë“±ë¡ ì˜¤ë¥˜:", err);
      }
    });

    // âœ… ì œì•ˆ ëª©ë¡ í‘œì‹œ
    async function loadSuggestions() {
      const div = document.getElementById("suggestions");
      div.innerHTML = "";
      try {
        const snap = await db.collection("suggestions").orderBy("created", "desc").get();
        if (snap.empty) {
          div.innerHTML = "<p>ì•„ì§ ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }
        snap.forEach(doc => {
          const d = doc.data();
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<strong>${d.name}</strong><p>${d.text}</p>`;
          div.appendChild(card);
        });
      } catch (err) {
        console.error("ì œì•ˆ ë¡œë“œ ì˜¤ë¥˜:", err);
      }
    }

    // âœ… ê´€ë¦¬ì ë¡œê·¸ì¸
    function adminLogin() {
      const pass = document.getElementById("admin-pass").value;
      if (pass === ADMIN_PASSWORD) {
        document.getElementById("admin-login").classList.add("hidden");
        document.getElementById("admin-panel").classList.remove("hidden");
        loadAdminSuggestions();
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    }

    // âœ… ê´€ë¦¬ì ì œì•ˆ ëª©ë¡ ë¡œë“œ
    async function loadAdminSuggestions() {
      const div = document.getElementById("admin-suggestions");
      div.innerHTML = "";
      try {
        const snap = await db.collection("suggestions").orderBy("created", "desc").get();
        if (snap.empty) {
          div.innerHTML = "<p>ë“±ë¡ëœ ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }
        snap.forEach(doc => {
          const d = doc.data();
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <strong>${d.name}</strong>
            <p>${d.text}</p>
            <button>ìŠ¤í† ë¦¬ë¡œ ë“±ë¡</button>
          `;
          const btn = card.querySelector("button");
          btn.addEventListener("click", () => approveStory(doc.id, d.text));
          div.appendChild(card);
        });
      } catch (err) {
        console.error("ê´€ë¦¬ì ì œì•ˆ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
      }
    }

    // âœ… ê´€ë¦¬ì ìŠ¹ì¸ í•¨ìˆ˜
    async function approveStory(id, text) {
      const title = prompt("ìƒˆ ìŠ¤í† ë¦¬ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:");
      if (!title) return;
      try {
        await db.collection("stories").add({ title, text });
        await db.collection("suggestions").doc(id).delete();
        alert("ìŠ¤í† ë¦¬ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
        loadAdminSuggestions();
      } catch (err) {
        console.error("ìŠ¹ì¸ ì˜¤ë¥˜:", err);
      }
    }
  </script>
</body>
</html>

