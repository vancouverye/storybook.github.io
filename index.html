<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì—°ìŠ¤-No.1 ìŠ¤í† ë¦¬ë¶ í”Œë«í¼</title>
  <style>
    body {
      margin: 0;
      font-family: "Noto Sans KR", sans-serif;
      background: #0d1117;
      color: #e6edf3;
    }
    header {
      background: #161b22;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      border-bottom: 1px solid #30363d;
    }
    header h1 { margin: 0; font-size: 20px; }
    nav button {
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 8px;
      color: #e6edf3;
      padding: 8px 12px;
      cursor: pointer;
      transition: 0.2s;
    }
    nav button:hover {
      background: #30363d;
    }
    .container {
      max-width: 1000px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .hidden { display: none; }
    .card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 20px;
    }
    .tab {
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 6px 10px;
      margin-right: 6px;
      cursor: pointer;
      color: #e6edf3;
    }
    .tab.active {
      background: #1f6feb;
      border-color: #1f6feb;
      color: white;
    }
    .story { margin-bottom: 14px; }
    textarea, input, select {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      color: #e6edf3;
      width: 100%;
      padding: 8px;
    }
    .btn {
      background: #238636;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn:hover { background: #2ea043; }
    .actions { margin-top: 10px; display: flex; gap: 8px; }
  </style>
</head>
<body>
<header>
  <h1>ğŸ“š ì—°ìŠ¤-No.1 ìŠ¤í† ë¦¬ë¶ í”Œë«í¼</h1>
  <nav>
    <button onclick="show('home')">í™ˆ</button>
    <button onclick="show('stories')">ìŠ¤í† ë¦¬ë¶</button>
    <button onclick="show('next')">ë‹¤ìŒ ì´ì•¼ê¸°</button>
    <button onclick="show('groups')">ê·¸ë£¹</button>
    <button onclick="show('admin')">ê´€ë¦¬ì</button>
  </nav>
</header>

<div class="container">
  <section id="home">
    <div class="card">
      <h2>í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹</h2>
      <p>â€˜ë‹¤ìŒ ì´ì•¼ê¸°â€™ì—ì„œ ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ì œì•ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
    </div>
    <div class="card" id="home-stories"></div>
  </section>

  <section id="stories" class="hidden">
    <div class="card">
      <div id="series-tabs"></div>
      <div id="series-desc" style="margin-top:8px;color:#8b949e;"></div>
    </div>
    <div id="story-list"></div>
  </section>

  <section id="next" class="hidden">
    <div class="card">
      <h2>ë‹¤ìŒ ì´ì•¼ê¸°ëŠ” ë¬´ì—‡ì¼ê¹Œ?</h2>
      <form id="nextForm">
        <input id="nextAuthor" placeholder="ì‘ì„±ì" required><br><br>
        <input id="nextTitle" placeholder="ì œëª©" required><br><br>
        <textarea id="nextText" rows="5" placeholder="ë‚´ìš©" required></textarea><br><br>
        <button class="btn" type="submit">ì˜¬ë¦¬ê¸°</button>
      </form>
    </div>
    <div class="card" id="nextList"></div>
  </section>

  <section id="groups" class="hidden">
    <div class="card" id="groupList"></div>
    <div class="card hidden" id="groupPostsCard">
      <h3 id="groupTitle"></h3>
      <form id="groupPostForm">
        <input id="gpAuthor" placeholder="ì‘ì„±ì" required><br><br>
        <input id="gpTitle" placeholder="ì œëª©" required><br><br>
        <textarea id="gpText" rows="4" placeholder="ë‚´ìš©" required></textarea><br><br>
        <button class="btn" type="submit">ê¸€ ë“±ë¡</button>
      </form>
      <div id="groupPosts"></div>
    </div>
  </section>

  <section id="admin" class="hidden">
    <div class="card" id="adminLogin">
      <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
      <input id="adminPass" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br><br>
      <button class="btn" onclick="adminLogin()">ë¡œê·¸ì¸</button>
    </div>
    <div class="card hidden" id="adminPanel">
      <h3>ê´€ë¦¬ì íŒ¨ë„</h3>
      <button class="btn" onclick="openAddSeries()">+ ì‹œë¦¬ì¦ˆ</button>
      <button class="btn" onclick="openAddStory()">+ ì±…</button>
      <button class="btn" onclick="openAddGroup()">+ ê·¸ë£¹</button>
      <div id="adminContent"></div>
    </div>
  </section>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBEBA0ZUVcMBG_G9CtauP02kh4Wneg-5gA",
  authDomain: "storybook-4a13b.firebaseapp.com",
  projectId: "storybook-4a13b",
  storageBucket: "storybook-4a13b.firebasestorage.app",
  messagingSenderId: "756981563455",
  appId: "1:756981563455:web:b0bef64ba3ca2fb39a788a",
  measurementId: "G-CPXLQYTYJY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let isAdmin = false;
let currentSeries = "ALL";
let currentGroup = null;

function $(id){return document.getElementById(id);}
function show(id){
  ["home","stories","next","groups","admin"].forEach(x => $(x).classList.add("hidden"));
  $(id).classList.remove("hidden");
  if(id==="stories") loadSeriesTabs();
  if(id==="home") loadHome();
  if(id==="next") loadNextList();
  if(id==="groups") loadGroups();
}

/* í™ˆ */
async function loadHome(){
  const box = $("home-stories");
  box.innerHTML = "";
  const snap = await db.collection("stories").limit(5).get();
  snap.forEach(doc=>{
    const s=doc.data();
    box.innerHTML += `<div class="story"><h4>${s.title}</h4><p>${s.text.slice(0,120)}...</p></div>`;
  });
}

/* ì‹œë¦¬ì¦ˆ + ìŠ¤í† ë¦¬ */
async function loadSeriesTabs(){
  const tabs = $("series-tabs");
  tabs.innerHTML = `<span class="tab active" onclick="currentSeries='ALL';loadStories();setActiveTab(this)">ì „ì²´</span>`;
  const snap = await db.collection("series").get();
  snap.forEach(doc=>{
    const s = doc.data();
    const b = document.createElement("span");
    b.className="tab";
    b.textContent = s.name;
    b.onclick=()=>{currentSeries=doc.id;loadStories();setActiveTab(b);$("series-desc").textContent=s.desc||"";}
    tabs.appendChild(b);
  });
  loadStories();
}
function setActiveTab(el){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  el.classList.add("active");
}
async function loadStories(){
  const box = $("story-list");
  box.innerHTML = "";
  let q = db.collection("stories");
  if(currentSeries!=="ALL") q=q.where("seriesId","==",currentSeries);
  const snap = await q.get();
  snap.forEach(doc=>{
    const s=doc.data();
    box.innerHTML += `
      <div class="card story">
        <h3>${s.title}</h3>
        <p>${s.text.slice(0,200)}...</p>
      </div>`;
  });
}

/* ë‹¤ìŒ ì´ì•¼ê¸° */
$("nextForm").onsubmit = async (e)=>{
  e.preventDefault();
  await db.collection("nextProposals").add({
    author:$("nextAuthor").value,
    title:$("nextTitle").value,
    text:$("nextText").value,
    status:"ëŒ€ê¸°",
    created:new Date()
  });
  $("nextForm").reset();
  loadNextList();
};
async function loadNextList(){
  const list=$("nextList");
  list.innerHTML="";
  const snap=await db.collection("nextProposals").get();
  snap.forEach(doc=>{
    const p=doc.data();
    list.innerHTML+=`
      <div class="card">
        <b>${p.title}</b><br>
        ${p.text.slice(0,120)}...
        <div class="actions"><small>${p.author}</small></div>
      </div>`;
  });
}

/* ê·¸ë£¹ */
async function loadGroups(){
  const box=$("groupList");
  box.innerHTML="";
  const snap=await db.collection("groups").get();
  snap.forEach(doc=>{
    const g=doc.data();
    box.innerHTML+=`
      <div class="card">
        <h3>${g.name}</h3>
        <p>${g.desc||""}</p>
        <button class="btn" onclick="openGroup('${doc.id}','${g.name}','${g.desc||""}')">ë“¤ì–´ê°€ê¸°</button>
      </div>`;
  });
}
function openGroup(id,name,desc){
  currentGroup=id;
  $("groupTitle").textContent=name;
  $("groupPostsCard").classList.remove("hidden");
  loadGroupPosts();
}
$("groupPostForm").onsubmit=async e=>{
  e.preventDefault();
  await db.collection("groupPosts").add({
    groupId:currentGroup,
    author:$("gpAuthor").value,
    title:$("gpTitle").value,
    text:$("gpText").value,
    created:new Date()
  });
  $("groupPostForm").reset();
  loadGroupPosts();
};
async function loadGroupPosts(){
  const box=$("groupPosts");
  box.innerHTML="";
  const snap=await db.collection("groupPosts").where("groupId","==",currentGroup).get();
  snap.forEach(doc=>{
    const p=doc.data();
    box.innerHTML+=`
      <div class="card">
        <b>${p.title}</b><br>${p.text}<br><small>${p.author}</small>
      </div>`;
  });
}

/* ê´€ë¦¬ì */
function adminLogin(){
  if($("adminPass").value==="admin1234"){
    isAdmin=true;
    $("adminLogin").classList.add("hidden");
    $("adminPanel").classList.remove("hidden");
    loadAdmin();
  }else alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
}
function loadAdmin(){
  const box=$("adminContent");
  box.innerHTML="<h4>ê´€ë¦¬ì ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”</h4>";
}
async function openAddSeries(){
  const name=prompt("ì‹œë¦¬ì¦ˆ ì´ë¦„:");
  const desc=prompt("ì‹œë¦¬ì¦ˆ ì„¤ëª…:");
  if(!name)return;
  await db.collection("series").add({name,desc,created:new Date()});
  alert("ì‹œë¦¬ì¦ˆ ì¶”ê°€ë¨!");
  loadSeriesTabs();
}
async function openAddStory(){
  const seriesSnap=await db.collection("series").get();
  if(seriesSnap.empty)return alert("ë¨¼ì € ì‹œë¦¬ì¦ˆë¥¼ ì¶”ê°€í•˜ì„¸ìš”!");
  const sId=prompt("ì‹œë¦¬ì¦ˆ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
  const title=prompt("ì±… ì œëª©:");
  const text=prompt("ì±… ë‚´ìš©:");
  await db.collection("stories").add({seriesId:sId,title,text,created:new Date()});
  alert("ì±… ì¶”ê°€ë¨!");
  loadStories();
}
async function openAddGroup(){
  const name=prompt("ê·¸ë£¹ ì´ë¦„:");
  const desc=prompt("ì„¤ëª…:");
  await db.collection("groups").add({name,desc,created:new Date()});
  alert("ê·¸ë£¹ ì¶”ê°€ë¨!");
  loadGroups();
}
</script>
</body>
</html>
