<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0a0f18;--bg2:#0d1424;--glass:#0f1726cc;--solid:#0f1726;
      --line:#1c2a40;--ink:#eaf1fb;--mut:#9fb0c3;--mute:#7d91a7;
      --pri:#6ea3ff;--pri2:#4f7ef3;--r:16px;--sh:0 22px 55px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:Inter,"Noto Sans KR",sans-serif;color:var(--ink);
      background:radial-gradient(70% 90% at 10% 0,#14213d 0,transparent 55%),radial-gradient(70% 80% at 100% 0,#12203a 0,transparent 50%),linear-gradient(180deg,#0a0f18 0,#0c1424 45%,#0a0f18 100%);
    }
    .app{display:grid;grid-template-rows:68px 1fr;min-height:100vh}
    .header{position:sticky;top:0;display:flex;align-items:center;gap:12px;padding:10px 16px;background:#0b1322cc;border-bottom:1px solid var(--line);backdrop-filter:blur(12px)}
    .brand{font-weight:800}
    .header-nav{margin-left:auto;display:flex;gap:8px}
    .btn{background:#0f1726;border:1px solid var(--line);border-radius:12px;padding:10px 14px;color:var(--ink);cursor:pointer;transition:.15s}
    .btn:hover{border-color:var(--pri)}
    .btn.pri{background:linear-gradient(180deg,var(--pri),var(--pri2));border-color:transparent;color:#fff}
    .section{display:none}.section.show{display:block}
    .card{background:var(--glass);border:1px solid var(--line);border-radius:var(--r);padding:16px;margin:12px 0}
    .story{background:#0f1726;border:1px solid var(--line);border-radius:18px;padding:16px;margin-bottom:14px}
    .tabs{display:flex;gap:10px;overflow-x:auto;padding:8px}
    .tab{border:1px solid var(--line);background:#0e1627;padding:8px 14px;border-radius:999px;cursor:pointer}
    .tab.active{background:linear-gradient(90deg,var(--pri),var(--pri2));color:#fff;border:none}
    .toast{position:fixed;right:20px;bottom:20px;background:#0b1322e6;border:1px solid var(--line);padding:10px 14px;border-radius:12px;display:none;z-index:400}
  </style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="brand">ğŸ“š ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶</div>
    <div class="header-nav">
      <button class="btn" data-page="home">í™ˆ</button>
      <button class="btn" data-page="stories">ìŠ¤í† ë¦¬ë¶</button>
      <button class="btn" data-page="next">ë‹¤ìŒ ì´ì•¼ê¸°</button>
      <button class="btn" data-page="groups">ê·¸ë£¹</button>
      <button class="btn pri" data-page="admin">ê´€ë¦¬ì</button>
    </div>
  </div>

  <main style="padding:18px;max-width:1100px;margin:auto">
    <!-- í™ˆ -->
    <section id="home" class="section show">
      <div class="card">
        <h2>í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹</h2>
        <p>â€˜ë‹¤ìŒ ì´ì•¼ê¸°â€™ íƒ­ì—ì„œ ìƒˆë¡œìš´ ì´ì•¼ê¸°ë¥¼ ì œì•ˆí•´ë³´ì„¸ìš”!</p>
      </div>
      <div class="card" id="home-stories"></div>
    </section>

    <!-- ìŠ¤í† ë¦¬ -->
    <section id="stories" class="section">
      <div class="card">
        <h2>ìŠ¤í† ë¦¬ë¶</h2>
        <div id="series-tabs" class="tabs"></div>
        <div id="series-desc" style="color:#9fb0c3;margin:8px 2px"></div>
        <div id="story-list"></div>
      </div>
    </section>

    <!-- ê´€ë¦¬ì -->
    <section id="admin" class="section">
      <div id="admin-login" class="card">
        <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
        <input id="admin-pass" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="width:200px;margin-right:6px">
        <button class="btn pri" id="btnAdminLogin">ë¡œê·¸ì¸</button>
      </div>
      <div id="admin-panel" class="card" style="display:none">
        <h3>ê´€ë¦¬ ì½˜ì†”</h3>
        <button class="btn pri" id="addSeries">+ ì‹œë¦¬ì¦ˆ</button>
        <button class="btn pri" id="addStory">+ ì±…</button>
        <div id="admin-series"></div>
      </div>
    </section>
  </main>
</div>
<div id="toast" class="toast"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
/* Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyBEBA0ZUVcMBG_G9CtauP02kh4Wneg-5gA",
  authDomain: "storybook-4a13b.firebaseapp.com",
  projectId: "storybook-4a13b",
  storageBucket: "storybook-4a13b.firebasestorage.app",
  messagingSenderId: "756981563455",
  appId: "1:756981563455:web:b0bef64ba3ca2fb39a788a",
  measurementId: "G-CPXLQYTYJY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let isAdmin=false, currentSeries="ALL";
const $=id=>document.getElementById(id);
const $$=sel=>document.querySelectorAll(sel);
function show(id){$$(".section").forEach(s=>s.classList.remove("show"));$(id).classList.add("show");}
function toast(msg){const t=$("toast");t.textContent=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1500);}

/* ë„¤ë¹„ê²Œì´ì…˜ */
$$("[data-page]").forEach(b=>b.onclick=()=>{show(b.dataset.page);if(b.dataset.page==="home")loadHome();if(b.dataset.page==="stories")loadSeriesTabs();});

/* í™ˆ */
async function loadHome(){
  const box=$("home-stories");box.innerHTML="";
  const snap=await db.collection("stories").get();
  if(snap.empty){box.innerHTML='<p>ì•„ì§ ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';return;}
  snap.forEach(doc=>{
    const s=doc.data();
    const el=document.createElement("div");el.className="story";
    el.innerHTML=`<h4>${s.title}</h4><p>${(s.text||"").slice(0,120)}...</p>`;
    box.appendChild(el);
  });
}

/* ì‹œë¦¬ì¦ˆ íƒ­ */
async function loadSeriesTabs(){
  const box=$("series-tabs");box.innerHTML="";
  const all=document.createElement("button");
  all.className="tab";all.textContent="ì „ì²´";
  all.onclick=()=>{currentSeries="ALL";highlightTabs();loadStories();};
  box.appendChild(all);
  const snap=await db.collection("series").get();
  snap.forEach(doc=>{
    const s=doc.data();
    const b=document.createElement("button");
    b.className="tab";b.textContent=s.name;b.dataset.sid=doc.id;
    b.onclick=()=>{currentSeries=doc.id;highlightTabs();loadStories();$("series-desc").textContent=s.desc||"";}
    box.appendChild(b);
  });
  currentSeries="ALL";highlightTabs();loadStories();
}
function highlightTabs(){
  $$(".tab").forEach(t=>{
    const a=(currentSeries==="ALL"&&t.textContent==="ì „ì²´")||t.dataset.sid===currentSeries;
    t.classList.toggle("active",a);
  });
}

/* ìŠ¤í† ë¦¬ ë¡œë“œ (ì‹œë¦¬ì¦ˆë³„) */
async function loadStories(){
  const box=$("story-list");box.innerHTML="";
  let snap;
  if(currentSeries==="ALL") snap=await db.collection("stories").get();
  else snap=await db.collection("stories").where("seriesId","==",currentSeries).get();
  if(snap.empty){box.innerHTML='<p>ì´ ì‹œë¦¬ì¦ˆì— ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</p>';return;}
  const data=[];
  snap.forEach(d=>data.push({id:d.id,...d.data()}));
  data.sort((a,b)=>b.created?.seconds - a.created?.seconds);
  data.forEach(s=>{
    const el=document.createElement("div");el.className="story";
    el.innerHTML=`<h4>${s.title}</h4><p>${(s.text||"").slice(0,200)}...</p>`;
    box.appendChild(el);
  });
}

/* ê´€ë¦¬ì */
$("btnAdminLogin").onclick=()=>{
  if($("admin-pass").value==="admin1234"){
    isAdmin=true;$("admin-login").style.display="none";$("admin-panel").style.display="block";loadAdminSeries();
  }else alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
};
$("addSeries").onclick=()=>{
  const name=prompt("ì‹œë¦¬ì¦ˆ ì´ë¦„");if(!name)return;
  const desc=prompt("ì‹œë¦¬ì¦ˆ ì„¤ëª…")||"";
  db.collection("series").add({name,desc,created:new Date()}).then(()=>{toast("ì‹œë¦¬ì¦ˆ ì¶”ê°€ë¨");loadSeriesTabs();loadAdminSeries();});
};
$("addStory").onclick=async()=>{
  const sSnap=await db.collection("series").get();
  if(sSnap.empty)return alert("ì‹œë¦¬ì¦ˆë¶€í„° ì¶”ê°€í•˜ì„¸ìš”.");
  const opts=[];sSnap.forEach(d=>opts.push(`${d.id}:${d.data().name}`));
  const sel=prompt("ì‹œë¦¬ì¦ˆ ID ì„ íƒ:\n"+opts.join("\n"));
  if(!sel)return;
  const title=prompt("ì±… ì œëª©");if(!title)return;
  const text=prompt("ë‚´ìš©")||"";
  const sid=sel.split(":")[0];
  db.collection("stories").add({seriesId:sid,title,text,created:new Date()}).then(()=>{toast("ì±… ì¶”ê°€ë¨");loadStories();loadHome();});
};
async function loadAdminSeries(){
  const box=$("admin-series");box.innerHTML="";
  const snap=await db.collection("series").get();
  snap.forEach(d=>{
    const s=d.data();
    box.innerHTML+=`<div class='story'><b>${s.name}</b><p>${s.desc||""}</p></div>`;
  });
}

/* ì´ˆê¸°í™” */
window.onload=()=>{loadHome();};
</script>
</body>
</html>
