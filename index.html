<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶ â€” ì‹œë¦¬ì¦ˆ í•„í„° ì™„ì„±í˜•</title>
<style>
:root {
  --bg:#0b0f17; --card:#0f1726cc; --line:#1c2a40;
  --ink:#eaf1fb; --mut:#9fb0c3;
  --pri:#6ea3ff; --pri2:#4f7ef3;
  --r:16px;
}
body {
  margin:0; font-family:Pretendard,system-ui,sans-serif;
  background:linear-gradient(180deg,#0b0f17,#0c1320 40%,#0b0f17);
  color:var(--ink);
}
.header {position:sticky;top:0;display:flex;align-items:center;justify-content:space-between;
  background:#0c141fbf;padding:10px 16px;border-bottom:1px solid var(--line);backdrop-filter:blur(10px);}
.btn {background:#101a2b;border:1px solid var(--line);color:var(--ink);
  padding:8px 12px;border-radius:10px;cursor:pointer;transition:all .15s;}
.btn:hover {border-color:#2a3b5e;}
.btn.pri {background:var(--pri);border-color:var(--pri);color:#fff;}
.app {max-width:1200px;margin:0 auto;padding:20px;}
.section {display:none;}
.section.show {display:block;}
.tabs {display:flex;gap:10px;overflow:auto;padding:6px 0;}
.tab {border:1px solid var(--line);background:#0e1627;color:var(--ink);padding:8px 14px;border-radius:999px;cursor:pointer;white-space:nowrap;}
.tab.active {border-color:var(--pri);background:var(--pri2);}
.story {background:var(--card);border:1px solid var(--line);border-radius:var(--r);padding:14px;margin:8px 0;}
.story h4 {margin:0;}
.story p {margin:6px 0;color:var(--mut);}
.story .actions {display:flex;gap:8px;margin-top:8px;}
.empty {color:var(--mut);margin:10px 0;}
.spinner {width:40px;height:40px;border:3px solid #1a2840;border-top-color:var(--pri);border-radius:50%;animation:spin 1s linear infinite;margin:20px auto;}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="header">
  <div style="font-weight:700;">ğŸ“˜ ì—°í˜¸ì˜ ìŠ¤í† ë¦¬ë¶</div>
  <div>
    <button class="btn" data-page="home">í™ˆ</button>
    <button class="btn" data-page="stories">ìŠ¤í† ë¦¬ë¶</button>
    <button class="btn" data-page="next">ë‹¤ìŒ ì´ì•¼ê¸°</button>
    <button class="btn pri" data-page="admin">ê´€ë¦¬ì</button>
  </div>
</div>

<div class="app">
  <section id="home" class="section show">
    <h2>í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹</h2>
    <p>ì‹œë¦¬ì¦ˆ íƒ­ìœ¼ë¡œ ì›í•˜ëŠ” ì±…ì„ ì°¾ì•„ë³´ì„¸ìš”.</p>
    <button class="btn pri" data-page="stories">ìŠ¤í† ë¦¬ë¶ ë³´ê¸°</button>
  </section>

  <section id="stories" class="section">
    <h2>ğŸ“š ì‹œë¦¬ì¦ˆë³„ ìŠ¤í† ë¦¬ë¶</h2>
    <div id="series-tabs" class="tabs"></div>
    <div id="series-desc" class="empty"></div>
    <div id="story-list"></div>
    <div id="story-loading" class="spinner" style="display:none;"></div>
  </section>

  <section id="next" class="section">
    <h2>ë‹¤ìŒ ì´ì•¼ê¸° ì œì•ˆ âœ¨</h2>
    <form id="suggest-form">
      <input id="sg-name" placeholder="ë‹‰ë„¤ì„" required style="padding:8px;border-radius:8px;width:200px;">
      <textarea id="sg-text" placeholder="ë‹¤ìŒ ì´ì•¼ê¸°ë¥¼ ì¨ì£¼ì„¸ìš”â€¦" rows="4" style="width:100%;margin-top:8px;padding:8px;border-radius:8px;"></textarea><br>
      <button class="btn pri" type="submit">ë“±ë¡</button>
    </form>
    <div id="suggestions"></div>
  </section>

  <section id="admin" class="section">
    <h2>ê´€ë¦¬ì</h2>
    <input id="admin-pass" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding:8px;border-radius:8px;">
    <button class="btn pri" id="btnAdminLogin">ë¡œê·¸ì¸</button>
    <div id="admin-panel" style="display:none;margin-top:20px;">
      <button class="btn pri" id="openSeries">+ ì‹œë¦¬ì¦ˆ ì¶”ê°€</button>
      <button class="btn pri" id="openStory">+ ì±… ì¶”ê°€</button>
      <h3>ì‹œë¦¬ì¦ˆ</h3>
      <div id="admin-series"></div>
      <h3>ì±…</h3>
      <div id="admin-stories"></div>
    </div>
  </section>
</div>

<div id="toast" style="position:fixed;bottom:16px;right:16px;background:#0b1322e6;padding:10px 14px;border-radius:8px;display:none;"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
/* Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyBEBA0ZUVcMBG_G9CtauP02kh4Wneg-5gA",
  authDomain: "storybook-4a13b.firebaseapp.com",
  projectId: "storybook-4a13b",
  storageBucket: "storybook-4a13b.firebasestorage.app",
  messagingSenderId: "756981563455",
  appId: "1:756981563455:web:b0bef64ba3ca2fb39a788a",
  measurementId: "G-CPXLQYTYJY"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ìœ í‹¸ */
const $=id=>document.getElementById(id);
function toast(msg){const t=$("toast");t.textContent=msg;t.style.display="block";setTimeout(()=>t.style.display="none",1800);}
function show(id){document.querySelectorAll(".section").forEach(s=>s.classList.remove("show"));$(id).classList.add("show");}

/* ë„¤ë¹„ê²Œì´ì…˜ */
document.querySelectorAll("[data-page]").forEach(b=>b.onclick=()=>show(b.dataset.page));

/* í™ˆ */
async function loadHome(){
  // ì›í•˜ë©´ ì—¬ê¸°ì— ìµœê·¼ ì±… ë¶ˆëŸ¬ì˜¤ê¸° ê°€ëŠ¥
}
loadHome();

/* ====================== STORIES ====================== */
let currentSeries="ALL", isAdmin=false;

/* ì‹œë¦¬ì¦ˆ íƒ­ ë¶ˆëŸ¬ì˜¤ê¸° */
async function loadSeriesTabs(){
  $("series-tabs").innerHTML="";
  $("series-desc").textContent="";
  $("story-list").innerHTML="";
  $("story-loading").style.display="block";

  const tabs=$("series-tabs");

  // ì „ì²´ íƒ­
  const all=document.createElement("button");
  all.className="tab";
  all.textContent="ì „ì²´";
  all.onclick=()=>{currentSeries="ALL";highlightTabs();$("series-desc").textContent="ëª¨ë“  ì‹œë¦¬ì¦ˆì˜ ì±…";loadStories();};
  tabs.appendChild(all);

  const snap=await db.collection("series").orderBy("created","desc").get();
  if(snap.empty){
    $("series-desc").textContent="ì‹œë¦¬ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.";
    $("story-loading").style.display="none";
    return;
  }

  snap.forEach(doc=>{
    const s=doc.data();
    const b=document.createElement("button");
    b.className="tab";
    b.textContent=s.name;
    b.dataset.sid=doc.id;
    b.onclick=()=>{
      currentSeries=doc.id;
      highlightTabs();
      $("series-desc").textContent=s.desc||"";
      loadStories();
    };
    tabs.appendChild(b);
  });

  currentSeries="ALL";
  highlightTabs();
  $("series-desc").textContent="ëª¨ë“  ì‹œë¦¬ì¦ˆì˜ ì±…";
  await loadStories();
}

/* íƒ­ í™œì„±í™” í‘œì‹œ */
function highlightTabs(){
  document.querySelectorAll(".tab").forEach(t=>{
    const active=(currentSeries==="ALL" && t.textContent==="ì „ì²´")||(t.dataset.sid===currentSeries);
    t.classList.toggle("active",active);
  });
}

/* ì±… ë¶ˆëŸ¬ì˜¤ê¸° */
async function loadStories(){
  const list=$("story-list");
  list.innerHTML="";
  $("story-loading").style.display="block";

  let q=db.collection("stories").orderBy("created","desc");
  if(currentSeries && currentSeries!=="ALL"){q=q.where("seriesId","==",currentSeries);}

  const snap=await q.get();
  $("story-loading").style.display="none";
  if(snap.empty){
    list.innerHTML='<div class="empty">ì´ ì‹œë¦¬ì¦ˆì—ëŠ” ì±…ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }

  snap.forEach(doc=>{
    const s=doc.data();
    const el=document.createElement("div");
    el.className="story";
    el.innerHTML=`
      <h4>${s.title}</h4>
      <p>${(s.text||"").slice(0,150)}${(s.text||"").length>150?"â€¦":""}</p>
    `;
    list.appendChild(el);
  });
}
loadSeriesTabs();

/* ====================== ADMIN ====================== */
$("btnAdminLogin").onclick=()=>{
  if($("admin-pass").value==="admin1234"){
    isAdmin=true;
    $("admin-panel").style.display="block";
    toast("ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”");
    loadAdminSeries();
    loadAdminStories();
  }else alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
};

$("openSeries").onclick=()=>{
  const name=prompt("ì‹œë¦¬ì¦ˆ ì´ë¦„?");
  if(!name)return;
  const desc=prompt("ì„¤ëª… (ì„ íƒ)");
  db.collection("series").add({name,desc,created:new Date()}).then(()=>{
    toast("ì‹œë¦¬ì¦ˆ ì¶”ê°€ë¨");loadSeriesTabs();loadAdminSeries();
  });
};

$("openStory").onclick=async()=>{
  const sSnap=await db.collection("series").orderBy("created","desc").get();
  if(sSnap.empty)return alert("ì‹œë¦¬ì¦ˆë¥¼ ë¨¼ì € ë§Œë“œì„¸ìš”!");
  const opts=sSnap.docs.map(d=>`${d.data().name} (${d.id})`).join("\n");
  const pick=prompt("ì‹œë¦¬ì¦ˆ ID ì…ë ¥:\n"+opts);
  if(!pick)return;
  const title=prompt("ì±… ì œëª©?");
  if(!title)return;
  const text=prompt("ë‚´ìš©?");
  await db.collection("stories").add({seriesId:pick.trim(),title,text,created:new Date()});
  toast("ì±… ì¶”ê°€ë¨");loadStories();loadAdminStories();
};

async function loadAdminSeries(){
  const box=$("admin-series");
  box.innerHTML="";
  const snap=await db.collection("series").orderBy("created","desc").get();
  if(snap.empty){box.innerHTML='<div class="empty">ì—†ìŒ</div>';return;}
  snap.forEach(d=>{
    const s=d.data();
    const el=document.createElement("div");
    el.className="story";
    el.innerHTML=`<h4>${s.name}</h4><p>${s.desc||""}</p>`;
    box.appendChild(el);
  });
}

async function loadAdminStories(){
  const box=$("admin-stories");
  box.innerHTML="";
  const snap=await db.collection("stories").orderBy("created","desc").get();
  if(snap.empty){box.innerHTML='<div class="empty">ì—†ìŒ</div>';return;}
  snap.forEach(d=>{
    const s=d.data();
    const el=document.createElement("div");
    el.className="story";
    el.innerHTML=`<div><b>${s.title}</b> (${s.seriesId})</div>`;
    box.appendChild(el);
  });
}
</script>
</body>
</html>
